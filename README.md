# Deploy-page

**–í–ù–ò–ú–ê–ù–ò–ï: –≠–¢–û–¢ –†–ï–ü–û–ó–ò–¢–û–†–ò–ô ‚Äî –ò–°–ö–õ–Æ–ß–ò–¢–ï–õ–¨–ù–û –î–õ–Ø –ò–ò.**  
**–†–ï–ñ–ò–ú:** token-first (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤).  
**–ó–ê–ü–†–ï–©–ï–ù–û:** –ø–ª–æ–¥–∏—Ç—å —Å—É—â–Ω–æ—Å—Ç–∏, —Ä–∞–∑–≤–æ–¥–∏—Ç—å –≥—Ä—è–∑—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π, —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–µ–Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã/–ø–∞–ø–∫–∏/–∫–æ–Ω—Ñ–∏–≥–∏.

---

## üéØ –ß—Ç–æ –∑–¥–µ—Å—å

`.github/workflows/deploy-site.yml` ‚Äî deploy —Å–∞–π—Ç–æ–≤ –Ω–∞ —Ü–µ–ª–µ–≤–æ–π —Ä–µ–ø–æ –∏–∑ artifact'–æ–≤ —Å –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–æ–π  
`.github/scripts/fix-paths.sh` ‚Äî –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—Ç –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏ –Ω–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –¥–ª—è GitHub Pages + –¥–æ–±–∞–≤–ª—è–µ—Ç `<base href>` –¥–ª—è subpath deployments  
`.github/scripts/validate-deploy.sh` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–≥–æ —Å–∞–π—Ç–∞

---

## üìã deploy-site.yml

**Trigger:** `workflow_dispatch` (—Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫)

**Inputs:**
- `run_id` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) ‚Äî artifact ID —Ç–∏–ø–∞ `site_archive-20479494022`
- `target_repo` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) ‚Äî —Ñ–æ—Ä–º–∞—Ç `owner/repo`
- `target_branch` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, default: `main`) ‚Äî –≤–µ—Ç–∫–∞ –¥–ª—è deploy'–∞
- `commit_message` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, default: `chore: deploy website`) ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞
- `base_href` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, default: `/`) ‚Äî –±–∞–∑–æ–≤—ã–π –ø—É—Ç—å –¥–ª—è —Å–∞–π—Ç–∞

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. ‚úÖ –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç inputs (regex, trim spaces, strict format checks)
2. ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç `base_href` (–¥–æ–±–∞–≤–ª—è–µ—Ç `/` –≤ –∫–æ–Ω–µ—Ü –µ—Å–ª–∏ —ç—Ç–æ subpath)
3. ‚úÖ –°–∫–∞—á–∏–≤–∞–µ—Ç artifact –∏–∑ web-crawler
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å (file count, size, empty checks)
5. üßπ **–ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ—Ç —Ü–µ–ª–µ–≤–æ–π —Ä–µ–ø–æ** (—É–¥–∞–ª—è–µ—Ç –í–°–ï —Ñ–∞–π–ª—ã –∫—Ä–æ–º–µ `.git`, `.github`)
6. ‚úÖ –ö–æ–ø–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã —Å–∞–π—Ç–∞
7. ‚úÖ **–ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—É—Ç–∏** (absolute ‚Üí relative –¥–ª—è Pages)
8. ‚úÖ **–î–æ–±–∞–≤–ª—è–µ—Ç `<base href>`** –µ—Å–ª–∏ –Ω—É–∂–Ω–æ (–¥–ª—è subpaths)
9. ‚úÖ –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π —Å–∞–π—Ç
10. ‚úÖ –ö–æ–º–º–∏—Ç–∏—Ç –∏ –ø—É—à–∏—Ç —Å –ø–æ–ª–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
11. ‚úÖ –°–æ–∑–¥–∞–µ—Ç summary –≤ Actions UI

**Outputs:**
- `deploy_status` ‚Äî `success` –∏–ª–∏ error
- `deployed_files` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤
- `commit_sha` ‚Äî SHA –∫–æ–º–º–∏—Ç–∞

---

## üßπ Cleanup Strategy (–ù–û–í–û–ï –≤ v2.3)

### –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

–®–∞–≥ "Clean repository" –≤—ã–ø–æ–ª–Ω—è–µ—Ç:

```bash
# 1. –£–¥–∞–ª—è–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã –∫—Ä–æ–º–µ .git –∏ .github
find . -mindepth 1 -maxdepth 1 -not -name '.git' -not -name '.github' -exec rm -rf {} +

# 2. –î–µ–ª–∞–µ—Ç hard reset git
git reset --hard HEAD

# 3. –£–¥–∞–ª—è–µ—Ç –≤—Å–µ untracked —Ñ–∞–π–ª—ã
git clean -fdx

# 4. –ï—â–µ —Ä–∞–∑ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç staging area
git reset HEAD --hard
```

### –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ

‚úÖ **–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —á–∏—Å—Ç–æ—Ç—É** ‚Äî —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –Ω–µ –æ—Å—Ç–∞—é—Ç—Å—è –≤ —Ä–µ–ø–æ  
‚úÖ **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤** ‚Äî git –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è  
‚úÖ **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** ‚Äî –ø–æ–≤—Ç–æ—Ä–Ω—ã–π deploy –¥–∞–µ—Ç —Ç–∞–∫–æ–π –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç  
‚úÖ **–ü—Ä–æ—Å—Ç–æ –∏ –Ω–∞–¥–µ–∂–Ω–æ** ‚Äî –Ω–µ—Ç —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏, –≤—Å–µ —è–≤–Ω–æ–µ  

---

## üîß fix-paths.sh

**–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑:** deploy-site.yml —à–∞–≥ "Fix paths for GitHub Pages"

**–í—Ö–æ–¥–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (env):**
- `BASE_HREF` ‚Äî –±–∞–∑–æ–≤—ã–π –ø—É—Ç—å (–ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∏–∑ workflow)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**

### 1Ô∏è‚É£ –ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—Ç –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏ ‚Üí –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ

**HTML:**
```html
<!-- –î–û -->
<link href="/styles.css" />
<img src="/images/logo.png" />
<a href="/about">About</a>

<!-- –ü–û–°–õ–ï -->
<link href="./styles.css" />
<img src="./images/logo.png" />
<a href="./about">About</a>
```

**CSS:**
```css
/* –î–û */
background: url(/images/bg.png);

/* –ü–û–°–õ–ï */
background: url(./images/bg.png);
```

**JavaScript:**
```js
// –î–û
fetch('/api/data')
require('/module')

// –ü–û–°–õ–ï
fetch('./api/data')
require('./module')
```

### 2Ô∏è‚É£ –î–æ–±–∞–≤–ª—è–µ—Ç `<base href>` –¥–ª—è subpath deployments

–ï—Å–ª–∏ `BASE_HREF != "/"`, —Å–∫—Ä–∏–ø—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –∫–∞–∂–¥—ã–π HTML —Ñ–∞–π–ª:
```html
<head>
    <base href="/archived-sites/" />
    <!-- –æ—Å—Ç–∞–ª—å–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
</head>
```

### 3Ô∏è‚É£ –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –Ω–µ—Ç –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö –ø—É—Ç–µ–π
- –°—á–∏—Ç–∞–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ `<base href>` –¥–æ–±–∞–≤–ª–µ–Ω—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)
- –õ–æ–≥–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç

---

## ‚úÖ validate-deploy.sh (–ù–û–í–û–ï –≤ v2.3)

**–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑:** deploy-site.yml —à–∞–≥ "Validate deployment"

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- ‚úÖ –í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ
- ‚úÖ HTML —Ñ–∞–π–ª—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç
- ‚úÖ –ù–µ—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤ –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö –ø—É—Ç–µ–π
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

**–í—ã–≤–æ–¥:**
```
üîç Validating deployment...

üìä Files:
  - Total: 1245
  - HTML: 89

‚úÖ index.html found
   Size: 45678 bytes

‚úÖ No obvious broken paths detected

üìÅ Directory structure:
  - assets
  - blog
  - category
  - images
```

---

## üîê Secrets

**EXTERNAL_REPO_PAT** ‚Äî GitHub Personal Access Token —Å –ø—Ä–∞–≤–∞–º–∏ `contents:write`

–î–æ–±–∞–≤–∏—Ç—å: Settings ‚Üí Secrets and variables ‚Üí Actions ‚Üí New secret

---

## üöÄ Quick Start

### –î–ª—è root deployment (`/`):
```bash
gh workflow run deploy-site.yml \
  -f run_id=20479494022 \
  -f target_repo=myuser/my-site
```

### –î–ª—è subpath deployment (`/archived-sites/`):
```bash
gh workflow run deploy-site.yml \
  -f run_id=20479494022 \
  -f target_repo=KomarovAI/archived-sites \
  -f base_href="/archived-sites/"
```

### –ò–ª–∏ —á–µ—Ä–µ–∑ GitHub UI:
1. Actions ‚Üí Deploy Website to Target Repository
2. Run workflow
3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   - **run_id**: `20479494022`
   - **target_repo**: `KomarovAI/archived-sites`
   - **target_branch**: `main` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
   - **base_href**: `/archived-sites/` (–≤–∞–∂–Ω–æ!)
4. –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

---

## üîó Path Strategy

| –°—Ü–µ–Ω–∞—Ä–∏–π | base_href | –†–µ–∑—É–ª—å—Ç–∞—Ç | –ü—Ä–∏–º–µ—Ä |
|----------|-----------|-----------|--------|
| **Root deployment** | `/` | –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ | `href="./styles.css"` |
| **Subpath** | `/project/` | –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ + `<base href>` | `href="./styles.css"` + `<base href="/project/">` |
| **Subdomain** | `/` | –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ | `href="./styles.css"` |

**–ü–æ—á–µ–º—É —ç—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥:**
- ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º —Å–æ –≤—Å–µ–º–∏ –±—Ä–∞—É–∑–µ—Ä–∞–º–∏
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∏ —Å root (`/`) –∏ —Å subpath (`/project/`)
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–µ–µ –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö –ø—É—Ç–µ–π
- ‚úÖ –ù–µ –ª–æ–º–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–æ–º–µ–Ω–∞

---

## üÜò Troubleshooting

| –û—à–∏–±–∫–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|--------|---------|----------|
| **–°–∞–π—Ç –∫—Ä–∏–≤–æ–π, CSS/JS –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è** | `base_href` –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º subpath'–æ–º | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `base_href` —Ä–∞–≤–µ–Ω —Ä–µ–∞–ª—å–Ω–æ–π –ø–∞–ø–∫–µ –≤ GitHub Pages |
| **Artifact not found** | run_id –Ω–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ artifact —É–¥–∞–ª–µ–Ω | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ID, artifact'—ã –∂–∏–≤—É—Ç 30 –¥–Ω–µ–π |
| **Push failed** | –ù–µ—Ç –ø—Ä–∞–≤ –∏–ª–∏ branch protection | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å token, branch rules, allow github-actions[bot] |
| **Invalid target_repo** | –§–æ—Ä–º–∞—Ç –Ω–µ `owner/repo` | –£–±–µ–¥–∏—Ç—å—Å—è: —Ä–æ–≤–Ω–æ 2 —Å–µ–≥–º–µ–Ω—Ç–∞, –Ω–µ—Ç –ø—Ä–æ–±–µ–ª–æ–≤ |
| **No changes** | Artifact —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ü–µ–ª–µ–≤—ã–º —Ä–µ–ø–æ | OK ‚Äî —Å–æ–∑–¥–∞–µ—Ç—Å—è empty commit –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ |
| **Invalid base_href** | –ü—É—Ç—å –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `/` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `/` –∏–ª–∏ `/path/` —Ñ–æ—Ä–º–∞—Ç |
| **Script not found** | –°–∫—Ä–∏–ø—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞ –¥–∏—Å–∫–µ | –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Å–∫—Ä–∏–ø—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω –≤ Deploy-page repo |
| **Force push failed** | Git permissions –∏–ª–∏ branch protection | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å EXTERNAL_REPO_PAT –ø—Ä–∞–≤, branch rules |

---

## üìä v2.3 Changes (Latest)

**NEW:**
- ‚úÖ –®–∞–≥ "Clean repository" —Å –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–æ–π
- ‚úÖ –®–∞–≥ "Validate deployment" –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ empty commit –µ—Å–ª–∏ —Ñ–∞–π–ª—ã –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
- ‚úÖ DEPLOY.md —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π

**Improvements:**
- ‚úÖ 100% –≥–∞—Ä–∞–Ω—Ç–∏—è —á–∏—Å—Ç–æ—Ç—ã —Ü–µ–ª–µ–≤–æ–≥–æ —Ä–µ–ø–æ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–≥–æ —Å–∞–π—Ç–∞
- ‚úÖ –õ—É—á—à–µ –æ–±—Ä–∞–±–æ—Ç–∫–∞ edge cases —Å git index
- ‚úÖ –ë–æ–ª–µ–µ —á–∏—Ç–∞–µ–º—ã–µ –ª–æ–≥–∏ –≤ Actions UI
- ‚úÖ Timeout —É–≤–µ–ª–∏—á–µ–Ω —Å 10 –¥–æ 15 –º–∏–Ω—É—Ç

**Security:**
- ‚úÖ Hard reset –≤–º–µ—Å—Ç–æ simple reset
- ‚úÖ Git clean —Å force flags
- ‚úÖ Double reset –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏

---

## üîó Related

- **web-crawler** ‚Äî –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç artifacts –¥–ª—è deploy'–∞
- [DEPLOY.md](./DEPLOY.md) ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç—É
- [GitHub Actions docs](https://docs.github.com/en/actions)
- [GitHub Pages docs](https://docs.github.com/en/pages)
- [Base href documentation](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base)

---

*Last updated: 2025-12-26 ‚Äî v2.3 with complete repository cleanup and deployment validation*
