# Deploy-page

**–í–ù–ò–ú–ê–ù–ò–ï: –≠–¢–û–¢ –†–ï–ü–û–ó–ò–¢–û–†–ò–ô ‚Äî –ò–°–ö–õ–Æ–ß–ò–¢–ï–õ–¨–ù–û –î–õ–Ø –ò–ò.**  
**–†–ï–ñ–ò–ú:** token-first (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤).  
**–ó–ê–ü–†–ï–©–ï–ù–û:** –ø–ª–æ–¥–∏—Ç—å —Å—É—â–Ω–æ—Å—Ç–∏, —Ä–∞–∑–≤–æ–¥–∏—Ç—å –≥—Ä—è–∑—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π, —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–µ–Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã/–ø–∞–ø–∫–∏/–∫–æ–Ω—Ñ–∏–≥–∏.

---

## üéØ –ß—Ç–æ –∑–¥–µ—Å—å

`.github/workflows/deploy-site.yml` ‚Äî deploy —Å–∞–π—Ç–æ–≤ –Ω–∞ —Ü–µ–ª–µ–≤–æ–π —Ä–µ–ø–æ –∏–∑ artifact'–æ–≤  
`.github/scripts/fix-paths.sh` ‚Äî –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—Ç –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏ –Ω–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –¥–ª—è GitHub Pages + –¥–æ–±–∞–≤–ª—è–µ—Ç `<base href>` –¥–ª—è subpath deployments

---

## üìã deploy-site.yml

**Trigger:** `workflow_dispatch` (—Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫)

**Inputs:**
- `run_id` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) ‚Äî artifact ID —Ç–∏–ø–∞ `site_archive-20479494022`
- `target_repo` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) ‚Äî —Ñ–æ—Ä–º–∞—Ç `owner/repo`
- `target_branch` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, default: `main`) ‚Äî –≤–µ—Ç–∫–∞ –¥–ª—è deploy'–∞
- `commit_message` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, default: `chore: deploy website`) ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞
- `base_href` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, default: `/`) ‚Äî –±–∞–∑–æ–≤—ã–π –ø—É—Ç—å –¥–ª—è —Å–∞–π—Ç–∞

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç inputs (regex, trim spaces, strict format checks)
2. –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç `base_href` (–¥–æ–±–∞–≤–ª—è–µ—Ç `/` –≤ –∫–æ–Ω–µ—Ü –µ—Å–ª–∏ —ç—Ç–æ subpath)
3. –°–∫–∞—á–∏–≤–∞–µ—Ç artifact –∏–∑ web-crawler
4. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å (file count, size, empty checks)
5. –û—á–∏—â–∞–µ—Ç —Ü–µ–ª–µ–≤–æ–π —Ä–µ–ø–æ (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `.git`, `.github`)
6. –ö–æ–ø–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã —Å–∞–π—Ç–∞
7. **–ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—É—Ç–∏** (absolute ‚Üí relative –¥–ª—è Pages)
8. **–î–æ–±–∞–≤–ª—è–µ—Ç `<base href>`** –µ—Å–ª–∏ –Ω—É–∂–Ω–æ (–¥–ª—è subpaths)
9. –ö–æ–º–º–∏—Ç–∏—Ç –∏ –ø—É—à–∏—Ç —Å –ø–æ–ª–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
10. –°–æ–∑–¥–∞–µ—Ç summary –≤ Actions UI

**Outputs:**
- `deploy_status` ‚Äî `committed` –∏–ª–∏ error
- `deployed_files` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤
- `commit_sha` ‚Äî SHA –∫–æ–º–º–∏—Ç–∞

---

## üîß fix-paths.sh

**–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑:** deploy-site.yml —à–∞–≥ "Fix paths for GitHub Pages"

**–í—Ö–æ–¥–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (env):**
- `BASE_HREF` ‚Äî –±–∞–∑–æ–≤—ã–π –ø—É—Ç—å (–ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∏–∑ workflow)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**

### 1Ô∏è‚É£ –ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—Ç –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏ ‚Üí –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ

**HTML:**
```html
<!-- –î–û -->
<link href="/styles.css" />
<img src="/images/logo.png" />
<a href="/about">About</a>

<!-- –ü–û–°–õ–ï -->
<link href="./styles.css" />
<img src="./images/logo.png" />
<a href="./about">About</a>
```

**CSS:**
```css
/* –î–û */
background: url(/images/bg.png);

/* –ü–û–°–õ–ï */
background: url(./images/bg.png);
```

**JavaScript:**
```js
// –î–û
fetch('/api/data')
require('/module')

// –ü–û–°–õ–ï
fetch('./api/data')
require('./module')
```

### 2Ô∏è‚É£ –î–æ–±–∞–≤–ª—è–µ—Ç `<base href>` –¥–ª—è subpath deployments

–ï—Å–ª–∏ `BASE_HREF != "/"`, —Å–∫—Ä–∏–ø—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –∫–∞–∂–¥—ã–π HTML —Ñ–∞–π–ª:
```html
<head>
    <base href="/archived-sites/" />
    <!-- –æ—Å—Ç–∞–ª—å–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
</head>
```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—Ä–∞—É–∑–µ—Ä—É –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–∑—Ä–µ—à–∞—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ subpath'–∞.

### 3Ô∏è‚É£ –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –Ω–µ—Ç –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö –ø—É—Ç–µ–π
- –°—á–∏—Ç–∞–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ `<base href>` –¥–æ–±–∞–≤–ª–µ–Ω—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)
- –õ–æ–≥–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç

---

## üîê Secrets

**EXTERNAL_REPO_PAT** ‚Äî GitHub Personal Access Token —Å –ø—Ä–∞–≤–∞–º–∏ `contents:write`

–î–æ–±–∞–≤–∏—Ç—å: Settings ‚Üí Secrets and variables ‚Üí Actions ‚Üí New secret

---

## üöÄ Quick Start

### –î–ª—è root deployment (`/`):
```bash
gh workflow run deploy-site.yml \
  -f run_id=20479494022 \
  -f target_repo=myuser/my-site
```

### –î–ª—è subpath deployment (`/archived-sites/`):
```bash
gh workflow run deploy-site.yml \
  -f run_id=20479494022 \
  -f target_repo=KomarovAI/archived-sites \
  -f base_href="/archived-sites/"
```

### –ò–ª–∏ —á–µ—Ä–µ–∑ GitHub UI:
1. Actions ‚Üí Deploy Website to Target Repository
2. Run workflow
3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   - **run_id**: `20479494022`
   - **target_repo**: `KomarovAI/archived-sites`
   - **target_branch**: `main` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
   - **base_href**: `/archived-sites/` (–≤–∞–∂–Ω–æ!)
4. –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

---

## üîó Path Strategy

| –°—Ü–µ–Ω–∞—Ä–∏–π | base_href | –†–µ–∑—É–ª—å—Ç–∞—Ç | –ü—Ä–∏–º–µ—Ä |
|----------|-----------|-----------|--------|
| **Root deployment** | `/` | –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ | `href="./styles.css"` |
| **Subpath** | `/project/` | –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ + `<base href>` | `href="./styles.css"` + `<base href="/project/">` |
| **Subdomain** | `/` | –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ | `href="./styles.css"` |

**–ü–æ—á–µ–º—É —ç—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥:**
- ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º —Å–æ –≤—Å–µ–º–∏ –±—Ä–∞—É–∑–µ—Ä–∞–º–∏
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∏ —Å root (`/`) –∏ —Å subpath (`/project/`)
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–µ–µ –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö –ø—É—Ç–µ–π
- ‚úÖ –ù–µ –ª–æ–º–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–æ–º–µ–Ω–∞

---

## üÜò Troubleshooting

| –û—à–∏–±–∫–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|--------|---------|----------|  
| **–°–∞–π—Ç –∫—Ä–∏–≤–æ–π, CSS/JS –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è** | `base_href` –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º subpath'–æ–º | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `base_href` —Ä–∞–≤–µ–Ω —Ä–µ–∞–ª—å–Ω–æ–π –ø–∞–ø–∫–µ –≤ GitHub Pages |
| **Artifact not found** | run_id –Ω–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ artifact —É–¥–∞–ª–µ–Ω | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ID, artifact'—ã –∂–∏–≤—É—Ç 30 –¥–Ω–µ–π |
| **Push failed** | –ù–µ—Ç –ø—Ä–∞–≤ –∏–ª–∏ branch protection | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å token, branch rules, allow github-actions[bot] |
| **Invalid target_repo** | –§–æ—Ä–º–∞—Ç –Ω–µ `owner/repo` | –£–±–µ–¥–∏—Ç—å—Å—è: —Ä–æ–≤–Ω–æ 2 —Å–µ–≥–º–µ–Ω—Ç–∞, –Ω–µ—Ç –ø—Ä–æ–±–µ–ª–æ–≤ |
| **No changes** | Artifact —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ü–µ–ª–µ–≤—ã–º —Ä–µ–ø–æ | OK ‚Äî deployment –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–µ–Ω |
| **Invalid base_href** | –ü—É—Ç—å –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `/` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `/` –∏–ª–∏ `/path/` —Ñ–æ—Ä–º–∞—Ç |
| **Script fix-paths.sh not found** | –°–∫—Ä–∏–ø—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞ –¥–∏—Å–∫–µ | –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Å–∫—Ä–∏–ø—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω –≤ Deploy-page repo |

---

## ‚úÖ v2.2.0 Changes (Latest)

**New:**
- ‚úÖ –°–∫—Ä–∏–ø—Ç `fix-paths.sh` —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `BASE_HREF` —á–µ—Ä–µ–∑ env –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ `/` –≤ –∫–æ–Ω–µ—Ü `base_href` –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ root (`/`) –∏ subpath deployments –≤ –æ–¥–Ω–æ–º —Å–∫—Ä–∏–ø—Ç–µ
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ fix-paths.sh
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ workflow –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

**Improvements:**
- ‚úÖ –£–±—Ä–∞–Ω –¥—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è –∫–æ–¥ –∏–∑ workflow
- ‚úÖ –í—Å—è –ª–æ–≥–∏–∫–∞ path fixing –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ (fix-paths.sh)
- ‚úÖ –õ—É—á—à–µ –æ–±—Ä–∞–±–æ—Ç–∫–∞ edge cases
- ‚úÖ –ë–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏

**Security:**
- ‚úÖ null-separator –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤ —Å–æ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–∞–º–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
- ‚úÖ –ü–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

---

## üìä v2.1 ‚Üí v2.2 –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

| –ê—Å–ø–µ–∫—Ç | v2.1 | v2.2 | –°—Ç–∞—Ç—É—Å |
|--------|------|------|--------|
| **base_href handling** | ‚ö†Ô∏è –î—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ workflow | ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ —Å–∫—Ä–∏–ø—Ç–µ | IMPROVED |
| **Path fixing** | ‚úÖ –•–æ—Ä–æ—à–æ | ‚úÖ –õ—É—á–µ | MAINTAINED |
| **Error handling** | ‚úÖ –ü–æ–ª–Ω–∞—è | ‚úÖ –ü–æ–ª–Ω–∞—è | MAINTAINED |
| **Compatibility** | ‚úÖ Root + subpath | ‚úÖ Root + subpath | MAINTAINED |
| **Code cleanliness** | ‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–π –¥—É–±–ª—å | ‚úÖ Clean | IMPROVED |

---

## üîó Related

- **web-crawler** ‚Äî –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç artifacts –¥–ª—è deploy'–∞
- [GitHub Actions docs](https://docs.github.com/en/actions)
- [GitHub Pages docs](https://docs.github.com/en/pages)
- [Base href documentation](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base)

---

*Last updated: 2025-12-26 ‚Äî v2.2 with centralized path fixing for subpaths*
