# Deploy-page

**–í–ù–ò–ú–ê–ù–ò–ï: –≠–¢–û–¢ –†–ï–ü–û–ó–ò–¢–û–†–ò–ô ‚Äî –ò–°–ö–õ–Æ–ß–ò–¢–ï–õ–¨–ù–û –î–õ–Ø –ò–ò.**  
**–†–ï–ñ–ò–ú:** token-first (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤).  
**–ó–ê–ü–†–ï–©–ï–ù–û:** –ø–ª–æ–¥–∏—Ç—å —Å—É—â–Ω–æ—Å—Ç–∏, —Ä–∞–∑–≤–æ–¥–∏—Ç—å –≥—Ä—è–∑—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π, —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–µ–Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã/–ø–∞–ø–∫–∏/–∫–æ–Ω—Ñ–∏–≥–∏.

---

## üéØ –ß—Ç–æ –∑–¥–µ—Å—å

`.github/workflows/deploy-site.yml` ‚Äî deploy —Å–∞–π—Ç–æ–≤ –Ω–∞ —Ü–µ–ª–µ–≤–æ–π —Ä–µ–ø–æ –∏–∑ artifact'–æ–≤  
`.github/scripts/fix-paths.sh` ‚Äî –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—Ç –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏ –Ω–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –¥–ª—è GitHub Pages

---

## üìã deploy-site.yml

**Trigger:** `workflow_dispatch` (—Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫)

**Inputs:**
- `run_id` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) ‚Äî artifact name —Ç–∏–ø–∞ `site_archive-20479494022`
- `target_repo` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) ‚Äî —Ñ–æ—Ä–º–∞—Ç `owner/repo`
- `target_branch` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, default: `main`) ‚Äî –≤–µ—Ç–∫–∞ –¥–ª—è deploy'–∞
- `commit_message` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞
- `base_href` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, default: `/`) ‚Äî –±–∞–∑–æ–≤—ã–π –ø—É—Ç—å –¥–ª—è —Å–∞–π—Ç–∞

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç inputs (regex, trim spaces, strict format checks)
2. –°–∫–∞—á–∏–≤–∞–µ—Ç artifact –∏–∑ web-crawler
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å (file count, size, empty checks)
4. –û—á–∏—â–∞–µ—Ç —Ü–µ–ª–µ–≤–æ–π —Ä–µ–ø–æ (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `.git`, `.github`, `README.md`, `LICENSE`)
5. –ö–æ–ø–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã —Å–∞–π—Ç–∞
6. –ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—É—Ç–∏ (absolute ‚Üí relative –¥–ª—è Pages)
7. –î–æ–±–∞–≤–ª—è–µ—Ç `<base href>` –µ—Å–ª–∏ –Ω—É–∂–Ω–æ (–¥–ª—è subpaths)
8. –ö–æ–º–º–∏—Ç–∏—Ç –∏ –ø—É—à–∏—Ç —Å –ø–æ–ª–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
9. –°–æ–∑–¥–∞–µ—Ç summary –≤ Actions UI

**Outputs:**
- `deploy_status` ‚Äî `committed`, `no_changes`, –∏–ª–∏ error
- `deployed_files` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤
- `commit_sha` ‚Äî SHA –∫–æ–º–º–∏—Ç–∞

---

## üîß fix-paths.sh

**–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑:** deploy-site.yml —à–∞–≥ "Fix paths for GitHub Pages"

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- HTML: `href="/path"` ‚Üí `href="./path"`, `src="/image"` ‚Üí `src="./image"`
- CSS: `url(/img.png)` ‚Üí `url(./img.png)`
- JS: `require('/mod')` ‚Üí `require('./mod')`, `fetch('/api')` ‚Üí `fetch('./api')`
- –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö –ø—É—Ç–µ–π
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üîê Secrets

**EXTERNAL_REPO_PAT** ‚Äî GitHub Personal Access Token —Å –ø—Ä–∞–≤–∞–º–∏ `contents:write`

–î–æ–±–∞–≤–∏—Ç—å: Settings ‚Üí Secrets and variables ‚Üí Actions ‚Üí New secret

---

## üÜò Troubleshooting

| –û—à–∏–±–∫–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|--------|---------|----------|
| Artifact not found | run_id –Ω–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ artifact —É–¥–∞–ª–µ–Ω | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ID, artifact –¥–æ–ª–∂–Ω—ã –∂–∏—Ç—å 30 –¥–Ω–µ–π |
| Push failed | –ù–µ—Ç –ø—Ä–∞–≤ –∏–ª–∏ branch protection | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å token, branch rules, allow github-actions[bot] |
| Invalid target_repo | –§–æ—Ä–º–∞—Ç –Ω–µ `owner/repo` | –£–±–µ–¥–∏—Ç—å—Å—è: —Ä–æ–≤–Ω–æ 2 —Å–µ–≥–º–µ–Ω—Ç–∞, –Ω–µ—Ç –ø—Ä–æ–±–µ–ª–æ–≤ |
| No changes | Artifact —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ü–µ–ª–µ–≤—ã–º —Ä–µ–ø–æ | OK ‚Äî deployment –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–µ–Ω |
| Invalid base_href | –ü—É—Ç—å –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å / | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `/` –∏–ª–∏ `/path/` —Ñ–æ—Ä–º–∞—Ç |
| Script fix-paths.sh not found | –°–∫—Ä–∏–ø—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞ –¥–∏—Å–∫–µ | –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Å–∫—Ä–∏–ø—Ç –Ω–∞ –º–µ—Å—Ç–µ –≤ deploy-page repo |

---

## ‚úÖ v2.1.0 Changes (Latest)

**Critical security fixes:**
- ‚úÖ –ó–∞–º–µ–Ω–µ–Ω–∞ sed –∫–æ–º–∞–Ω–¥–∞ –Ω–∞ awk –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω null-separator (`-print0`) –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (`set -e`)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤
- ‚úÖ –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

**New:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Ñ–∞–π–ª –∏–º–µ–µ—Ç `<head>` –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º `<base>`
- ‚úÖ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è `<base>` —Ç–µ–≥–æ–≤
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏ —Å–æ–¥–µ—Ä–∂–∞—â–∏–º–∏ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ

**Improvements:**
- ‚úÖ –õ—É—á—à–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—É—Ç–µ–π —Å —Ç–æ—á–∫–∞–º–∏ (`/my-project-v2.0/`)
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö
- ‚úÖ –í—ã—Ö–æ–¥ –Ω–∞ –ø–µ—Ä–≤–æ–π –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–µ

---

## üìä v2.0 ‚Üí v2.1 Changes

| –ê—Å–ø–µ–∫—Ç | v2.0 | v2.1 | –°—Ç–∞—Ç—É—Å |
|--------|------|------|--------|
| **sed escaping** | ‚ùå –£—è–∑–≤–∏–º–æ | ‚úÖ awk | FIXED |
| **Error handling** | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–∞—è | ‚úÖ –ü–æ–ª–Ω–∞—è | IMPROVED |
| **File safety** | ‚ùå –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ | ‚úÖ null-separator | FIXED |
| **Input validation** | ‚úÖ –•–æ—Ä–æ—à–æ | ‚úÖ Strict | MAINTAINED |
| **Logging** | ‚úÖ –•–æ—Ä–æ—à–æ | ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–µ–µ | IMPROVED |
| **base_href logic** | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–µ–µ | IMPROVED |

---

## üöÄ Quick Start

### –ó–∞–ø—É—Å—Ç–∏—Ç—å deployment:
```bash
gh workflow run deploy-site.yml \
  -f run_id=20479494022 \
  -f target_repo=myuser/my-site \
  -f target_branch=main \
  -f base_href="/my-project/"
```

### –ò–ª–∏ —á–µ—Ä–µ–∑ GitHub UI:
1. Actions ‚Üí Deploy Website to Target Repository
2. Run workflow
3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
4. –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

---

## üîó Related

- **web-crawler** ‚Äî –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç artifacts –¥–ª—è deploy'–∞
- [GitHub Actions docs](https://docs.github.com/en/actions)
- [GitHub Pages docs](https://docs.github.com/en/pages)

---

## üìö Documentation

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ —Ä–µ–ø–æ:
- `fix_summary.md` ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ –æ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö v2.1
- `best_practices.md` ‚Äî best practices –¥–ª—è Bash –≤ GitHub Actions
- `test_changes.sh` ‚Äî —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `IMPROVEMENT_REPORT.md` ‚Äî –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –æ –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ

---

*Last updated: 2025-12-26 ‚Äî v2.1 production ready with security improvements*